(this.webpackJsonpchat=this.webpackJsonpchat||[]).push([[0],{250:function(e,a,t){e.exports=t.p+"static/media/readed.c1f419d6.svg"},251:function(e,a,t){e.exports=t.p+"static/media/noreaded.3c841bf6.svg"},252:function(e,a,t){e.exports=t.p+"static/media/wave.2b8196a5.svg"},253:function(e,a,t){e.exports=t.p+"static/media/play.65f03140.svg"},254:function(e,a,t){e.exports=t.p+"static/media/pause.a61933e8.svg"},271:function(e,a,t){e.exports=t(504)},276:function(e,a,t){},281:function(e,a,t){},282:function(e,a,t){},303:function(e,a,t){},431:function(e,a){},434:function(e,a,t){},435:function(e,a,t){},436:function(e,a,t){},437:function(e,a,t){},438:function(e,a,t){},441:function(e,a,t){},442:function(e,a,t){},470:function(e,a,t){},504:function(e,a,t){"use strict";t.r(a);var n=t(0),r=t.n(n),c=t(9),i=t.n(c),l=(t(276),t(277),t(18)),s=t(48),o=t(17),u=(t(281),t(508)),d=t(514),m=t(65),E=(t(282),t(1)),f=t.n(E),g=function(e){return r.a.createElement(m.a,Object.assign({disabled:e.disabled,className:f()("button",e.className,{"button--large":"large"===e.size})},e))},_=(t(303),function(e){var a=e.children,t=e.className;return r.a.createElement("div",{className:f()("block",t)}," ",a," ")}),p=function(e,a){return e?a&&e?"error":"success":""},h={labelCol:{span:0},wrapperCol:{span:25}},v=function(e){e.values;var a=e.errors,t=e.touched,n=e.handleChange,c=e.handleBlur,i=e.handleSubmit,l=e.isSubmitting,o=e.isValid;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"auth__top"},r.a.createElement("h2",null,"\u0412\u043e\u0439\u0442\u0438 \u0432 \u0430\u043a\u043a\u0430\u0443\u043d\u0442"),r.a.createElement("p",null,"\u041f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430, \u0432\u043e\u0439\u0434\u0438\u0442\u0435 \u0432 \u0441\u0432\u043e\u0439 \u0430\u043a\u043a\u0430\u0443\u043d\u0442")),r.a.createElement(_,null,r.a.createElement(u.a,Object.assign({},h,{onFinish:function(){i()}}),r.a.createElement(u.a.Item,{name:"email",help:t.email&&a.email,onChange:n,onBlur:c,validateStatus:p(t.email,a.email),hasFeedback:!0,rules:[{required:!0,message:"Please input your E-Mail"}]},r.a.createElement(d.a,{size:"large",placeholder:"E-Mail"})),r.a.createElement(u.a.Item,{name:"password",help:t.password&&a.password,onChange:n,onBlur:c,validateStatus:p(t.password,a.password),hasFeedback:!0,rules:[{required:!0,message:"Please input your password"}]},r.a.createElement(d.a.Password,{size:"large",placeholder:"Password"})),r.a.createElement(u.a.Item,null,l&&!o&&r.a.createElement("span",null,"\u041e\u0448\u0438\u0431\u043a\u0430!"),r.a.createElement(g,{disabled:l,size:"large",type:"primary",htmlType:"submit"},"\u0412\u043e\u0439\u0442\u0438 \u0432 \u0430\u043a\u043a\u0430\u0443\u043d\u0442"))),r.a.createElement(s.b,{className:"auth__register-link",to:"/register"},"\u0417\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u0442\u044c\u0441\u044f")))},b=t(139),S=function(e){var a=e.isAuth,t=e.values,n=e.errors,r={email:function(e){e?/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,}$/i.test(e)||(n.email="\u041d\u0435\u0432\u0435\u0440\u043d\u044b\u0439 E-Mail"):n.email="\u0412\u0432\u0435\u0434\u0438\u0442\u0435 E-Mail"},name:function(e){e||(n.name="\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0432\u0430\u0448\u0435 \u0438\u043c\u044f")},password:function(e){e?a||/^(?=.*\d)(?=.*[a-z])(?=.*[A-Z])(?=.*[a-zA-Z]).{8,}$/i.test(e)||(n.password="\u0421\u043b\u0438\u0448\u043a\u043e\u043c \u043b\u0435\u0433\u043a\u0438\u0439 \u043f\u0430\u0440\u043e\u043b\u044c"):n.password="\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u043f\u0430\u0440\u043e\u043b\u044c"},repeatPassword:function(e){e?e!==t.password&&(n.repeatPassword="\u041f\u0430\u0440\u043e\u043b\u0438 \u043d\u0435 \u0441\u043e\u0432\u043f\u0430\u0434\u0430\u044e\u0442"):n.repeatPassword="\u041f\u043e\u0432\u0442\u043e\u0440\u0438\u0442\u0435 \u043f\u0430\u0440\u043e\u043b\u044c"}};Object.keys(t).forEach((function(e){return r[e]&&r[e](t[e])}))},O=t(248),D=t.n(O).a.create({baseURL:"http://localhost:3003"}),j=function(){return D.get("/dialogs",{headers:{token:window.localStorage.token}})},A=function(e,a,t){return D.post("/dialogs",{author:e,partner:a,text:t},{headers:{token:window.localStorage.token}})},T=function(e,a){return D.post("/messages/",{text:e,dialog:a},{headers:{token:window.localStorage.token}})},N=function(e){return D.get("/messages/".concat(e))},y=function(e){return D.post("/user/login",e)},R=function(e){return D.get("/user/find?query=".concat(e),{headers:{token:window.localStorage.token}})},C=function(e){return D.get("/user/me",{headers:{token:e}})},w=function(e){return D.post("/user/registration",e)},k=t(515),I=function(e){var a=e.text,t=e.title,n=e.type,r=void 0===n?"info":n;return k.a[r]({message:t,description:a})},L=t(133),M=t.n(L),U={setDialogs:function(e){return{type:"DIALOGS_SET_ITEMS",payload:e}},addDialog:function(e){return{type:"ADD_DIALOG",payload:e}},clearDialogs:function(){return{type:"CLEAR_DIALOGS"}},setPartnerStatus:function(e,a){return{type:"SET_PARTNER_STATUS",payload:{partnerId:e,isOnline:a}}},updateUnreadedCount:function(e,a){return{type:"UPDATE_UNREADED_COUNT",payload:{dialogId:e,unreadedCount:a}}},setCurrentDialog:function(e){return function(a,t){var n=t(),r=n.user,c=r.data,i=r.socket,l=n.dialogs.dialogs.filter((function(a){return a._id===e}))[0],s=c._id===l.author._id?l.partner._id:l.author._id;i.emit("DIALOG_ENTERED",{dialog_id:e,partner_id:s}),a(U.updateUnreadedCount(l._id,0)),a({type:"SET_CURRENT_DIALOG_ID",payload:e})}},updateLastMessage:function(e,a){return{type:"UPDATE_LAST_MESSAGE",payload:{dialogId:e,message:a}}},updateLastMessageReaded:function(e){return{type:"UPDATE_LAST_MESSAGE_READED",payload:e}},createDialog:function(e,a){return function(t,n){var r=n().user.data;return A(r._id,e,a).then((function(e){var a=e.data;t(U.addDialog(a))}))}},fetchDialogs:function(){return function(e){return j().then((function(a){var t=a.data;t.length&&e(U.setDialogs(t))}))}}},G={setMessages:function(e){return{type:"SET_CURRENT_DIALOG",payload:e}},clearCurrentDialog:function(){return{type:"CLEAR_CURRENT_DIALOG"}},addMessage:function(e){return{type:"ADD_MESSAGE",payload:e}},updateIsReaded:function(e,a){return function(a,t){var n=t().user.data;a({type:"UPDATE_IS_READED",payload:{dialogId:e,myId:n._id}})}},sendMessage:function(e){return function(a,t){var n=t().currentDialog.currentDialog;T(e,n)}},setLoading:function(e){return{type:"SET_LOADING",payload:e}},fetchMessages:function(e){return function(a){a(G.setLoading(!0)),N(e).then((function(e){var t=e.data;a(G.setMessages(t||null))}))}}},x={setUserData:function(e){return{type:"USER_SET_DATA",payload:e}},clearUserData:function(){return function(e,a){a().user.socket.disconnect(),window.localStorage.clear(),e({type:"CLEAR_USER_DATA"})}},setToken:function(e){return{type:"SET_TOKEN",payload:e}},setIsAuth:function(e){return{type:"SET_IS_AUTH",payload:e}},socketCreateConnection:function(e){return{type:"SOCKET_CREATE_CONNECTION",payload:M.a.connect("https://whispering-dawn-05999.herokuapp.com/",{query:{token:e}})}},fetchUserData:function(e){return function(a){C(e).then((function(e){var t=e.data;a(x.setUserData(t))}))}},fetchUserLogin:function(e){return function(a,t){return y(e).then((function(e){var n=e.data,r=n.status,c=n.token;if("error"===r)I({text:"\u041d\u0435\u0432\u0435\u0440\u043d\u044b\u0439 \u043b\u043e\u0433\u0438\u043d \u0438\u043b\u0438 \u043f\u0430\u0440\u043e\u043b\u044c",title:"\u041e\u0448\u0438\u0431\u043a\u0430 \u043f\u0440\u0438 \u0430\u0432\u0442\u043e\u0440\u0438\u0437\u0430\u0446\u0438\u0438",type:"error"});else{I({title:"\u041e\u0442\u043b\u0438\u0447\u043d\u043e!",text:"\u0410\u0432\u0442\u043e\u0440\u0438\u0437\u0430\u0446\u0438\u044f \u0443\u0441\u043f\u0435\u0448\u043d\u0430",type:"success"}),window.localStorage.token=c;t().user.socket;a(x.socketCreateConnection(c)),a(x.setToken(c)),a(x.setIsAuth(!0)),a(x.fetchUserData(c))}return r}))}},fetchUserRegistration:function(e){return function(a,t){return w(e).then((function(e){var n=e.data,r=n.status,c=n.token;"error"===r?I({text:"\u041e\u0448\u0438\u0431\u043a\u0430 \u043f\u0440\u0438 \u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u0438",title:"\u0423\u043f\u0441",type:"error"}):(I({title:"\u041e\u0442\u043b\u0438\u0447\u043d\u043e!",text:"\u0420\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u044f \u043f\u0440\u043e\u0448\u043b\u0430 \u0443\u0441\u043f\u0435\u0448\u043d\u043e",type:"success"}),window.localStorage.token=c,t().user.socket.disconnect(),a(x.socketCreateConnection(c)),a(x.setToken(c)),a(x.setIsAuth(!0)),a(x.fetchUserData(c)));return r}))}}},P=Object(l.b)((function(e){return e}),x)(Object(o.g)((function(e){var a=e.fetchUserLogin,t=e.history;return r.a.createElement("div",null,r.a.createElement(b.a,{initialValues:{email:"",password:""},validate:function(e){var a={};return S({isAuth:!0,values:e,errors:a}),a},onSubmit:function(e,n){var r=n.setSubmitting;r(!0),a(e).then((function(e){"success"===e?t.push("/"):r(!1)})).catch((function(e){r(!1)}))}},v))}))),V=function(e){var a=e.name,t=e.placeholder,n=e.type,c=e.handleChange,i=e.handleBlur,l=e.touched,s=e.errors,o=e.defaultValue;return r.a.createElement(u.a.Item,{help:l[a]&&s[a],name:a,onChange:c,onBlur:i,validateStatus:p(l[a],s[a]),hasFeedback:!0,defaultValue:o},"password"===n?r.a.createElement(d.a.Password,{size:"large",placeholder:t}):r.a.createElement(d.a,{size:"large",placeholder:t}))},z={labelCol:{span:0},wrapperCol:{span:25}},H=function(e){var a=e.values,t=e.errors,n=e.touched,c=e.handleChange,i=e.handleBlur,l=e.handleSubmit,o=e.setTouched;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"auth__top"},r.a.createElement("h2",null,"\u0417\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u0443\u0439\u0442\u0435\u0441\u044c"),r.a.createElement("p",null,"\u0414\u043b\u044f \u0432\u0445\u043e\u0434\u0430 \u0432 \u0447\u0430\u0442, \u043d\u0443\u0436\u043d\u043e \u0437\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u0442\u044c\u0441\u044f")),r.a.createElement(_,null,r.a.createElement(u.a,Object.assign({},z,{onFinish:function(){l()}}),r.a.createElement(V,{name:"email",placeholder:"E-mail",touched:n,errors:t,handleChange:c,handleBlur:i,defaultValue:a.email}),r.a.createElement(V,{name:"name",placeholder:"\u0412\u0430\u0448\u0435 \u0438\u043c\u044f",touched:n,errors:t,handleChange:c,handleBlur:i,defaultValue:a.name}),r.a.createElement(V,{type:"password",name:"password",placeholder:"\u041f\u0430\u0440\u043e\u043b\u044c",touched:n,errors:t,handleChange:c,handleBlur:i,defaultValue:a.password}),r.a.createElement(V,{type:"password",name:"repeatPassword",placeholder:"\u041f\u043e\u0432\u0442\u043e\u0440\u0438\u0442\u0435 \u043f\u0430\u0440\u043e\u043b\u044c",touched:n,errors:t,handleChange:c,handleBlur:i,defaultValue:a.repeatPassword}),r.a.createElement(u.a.Item,null,r.a.createElement(g,{onClick:function(){o({email:!0,name:!0,password:!0,repeatPassword:!0})},size:"large",type:"primary",htmlType:"submit"},"\u0417\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u0442\u044c\u0441\u044f"))),r.a.createElement(s.b,{className:"auth__register-link",to:"/login"},"\u0412\u043e\u0439\u0442\u0438 \u0432 \u0430\u043a\u043a\u0430\u0443\u043d\u0442")))},F=Object(l.b)((function(e){return e}),x)(Object(o.g)((function(e){var a=e.fetchUserRegistration,t=e.history;return r.a.createElement("div",null,r.a.createElement(b.a,{initialValues:{email:"",name:"",password:"",repeatPassword:""},validate:function(e){var a={};return S({isAuth:!1,values:e,errors:a}),a},onSubmit:function(e,n){var r=n.setSubmitting;a(e).then((function(e){"success"===e?t.push("/"):r(!1)})).catch((function(e){r(!1)}))}},H))}))),B=function(){return r.a.createElement("div",{className:"auth"},r.a.createElement("div",{className:"auth__wrapper"},r.a.createElement(o.d,null,r.a.createElement(o.b,{exact:!0,path:["/","/login"],component:P}),r.a.createElement(o.b,{exact:!0,path:"/register",component:F}))))},Y=(t(434),t(3)),q=t(14),K=t(181),Z=t(513),$=function(e){return e?"".concat(Math.floor(e/60)>=10?Math.floor(e/60):"0"+Math.floor(e/60),":").concat(Math.floor(e%60)>=10?Math.floor(e%60):"0"+Math.floor(e%60)):"00:00"},J=(t(435),t(250)),W=t.n(J),X=t(251),Q=t.n(X),ee=function(e){e.isMe;var a=e.isReaded,t=e.className;return r.a.createElement("div",{className:t},r.a.createElement("img",{src:a?W.a:Q.a,alt:""}))},ae=t(122),te=t.n(ae),ne=function(e){var a=e.substr(-3,3).split("").map((function(e){return(a=e.charCodeAt())>255?a%255:a<0?-a%255:a;var a})),t=Object(q.a)(a,3),n=t[0],r=t[1],c=t[2];return{color:te()({r:n,g:r,b:c}).lighten(10).saturate(20).toHexString(),lightenColor:te()({r:n,g:r,b:c}).saturate(20).lighten(30).toHexString()}},re=(t(436),function(e){if(e)return e}),ce=function(e){var a=e.avatarSrc,t=e.hash,n=e.username.charAt(0);return r.a.createElement("div",{className:"avatar"},a?r.a.createElement("img",{src:re(a),alt:"User avatar"}):r.a.createElement("div",{className:"avatar__gradient",style:{background:"linear-gradient(115deg, ".concat(ne(t).color,", ").concat(ne(t).lightenColor,")")}},r.a.createElement("span",null,n)))},ie=t(252),le=t.n(ie),se=t(253),oe=t.n(se),ue=t(254),de=t.n(ue),me=function(e){var a=e.audioSrc,t=Object(n.useState)(!1),c=Object(q.a)(t,2),i=c[0],l=c[1],s=Object(n.useState)(0),o=Object(q.a)(s,2),u=o[0],d=o[1],m=Object(n.useState)(0),E=Object(q.a)(m,2),f=E[0],g=E[1],_=Object(n.useState)(0),p=Object(q.a)(_,2),h=p[0],v=p[1],b=Object(n.useRef)(null);Object(n.useEffect)((function(){b.current&&(b.current.addEventListener("canplay",(function(){v(b.current.duration)}),!1),b.current.addEventListener("playing",(function(){l(!0)}),!1),b.current.addEventListener("ended",(function(){l(!1),g(0),d(0)}),!1),b.current.addEventListener("pause",(function(){l(!1)}),!1),b.current.addEventListener("timeupdate",(function(){d(b.current.currentTime)})))}),[]),Object(n.useEffect)((function(){b.current&&g(u/h*100)}),[u,h]);return r.a.createElement("div",{className:"message__audio"},r.a.createElement("audio",{ref:b,src:a,preload:"metadata"}),r.a.createElement("div",{className:"message__audio-progress",style:{width:f+"%"}}),r.a.createElement("div",{className:"message__audio-control"},r.a.createElement("div",{className:"message__audio-btn"},r.a.createElement("button",{onClick:function(){i?b.current.pause():b.current.play()}},r.a.createElement("img",{src:i?de.a:oe.a,alt:"play-button"}))),r.a.createElement("div",{className:"message__audio-wave"},r.a.createElement("img",{src:le.a,alt:"wave"})),r.a.createElement("span",{className:"message__audio-duration"},$(h-u))))},Ee=function(e){var a=e.avatar,t=e.text,c=e.date,i=e.user,l=e.isMe,s=e.isReaded,o=e.audio,u=e.attachments,d=e.isTyping,m=Object(n.useState)(),E=Object(q.a)(m,2),g=E[0],_=E[1],p=Object(n.useRef)(null);return Object(n.useEffect)((function(){return clearInterval(p.current),c&&(_(Object(K.a)(new Date(c),{addSuffix:!0,locale:Z.a})),p.current=setInterval((function(){_(Object(K.a)(new Date(c),{addSuffix:!0,locale:Z.a}))}),6e4)),function(){clearInterval(p.current)}}),[c]),o||t||d||u.length?r.a.createElement("div",{className:f()("message",{"message--isme":l,"message--is-typing":d,"message--image":u&&1===u.length,"message--audio":o})},r.a.createElement("div",{className:"message__wrap"},r.a.createElement("div",{className:"message__avatar"},r.a.createElement(ce,{avatarSrc:a,hash:i._id,username:i.fullname})),r.a.createElement("div",null,r.a.createElement("div",{className:"message__content"},(o||t||d)&&r.a.createElement("div",{className:"message__bubble"},r.a.createElement("div",{className:"message__typing"},r.a.createElement("span",null),r.a.createElement("span",null),r.a.createElement("span",null)),t&&r.a.createElement("p",{className:"message__text"},t),o&&r.a.createElement(me,{audioSrc:o})),u.length?r.a.createElement("div",{className:"message__attachments"},u.map((function(e,a){return r.a.createElement("div",{key:a,className:"message__attachments-item"},r.a.createElement("img",{src:e.url,alt:e.filename}))}))):""),!d&&r.a.createElement("span",{className:"message__date"},g)),l?r.a.createElement(ee,{className:"message__readed-icon",isReaded:s}):"")):r.a.createElement("div",null)};Ee.defaultProps={user:{},attachments:[]};var fe=Ee,ge=(t(437),t(517));var _e=function(e){var a=e.inputSubmitHandler,t=e.handleTyping,c=Object(n.useState)(),i=Object(q.a)(c,2),l=i[0],s=i[1];return r.a.createElement("div",{className:"message-input"},r.a.createElement("div",{className:"message-input__textarea"},r.a.createElement(d.a,{onChange:function(e){s(e.target.value)},onKeyUp:function(e){"Enter"===e.key&&e.target.value?(a(l),s("")):t()},placeholder:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0442\u0435\u043a\u0441\u0442 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u044f...",size:"large",value:l})),r.a.createElement("div",{className:"message-input__actions"},r.a.createElement(m.a,{onClick:function(){l&&(a(l),s(""))},className:"ant-btn--no-border",shape:"circle",icon:r.a.createElement(ge.a,{style:{fontSize:"20px"}})})))},pe=Object(l.b)((function(e){var a=e.user,t=e.currentDialog;return{me:a.data,socket:a.socket,dialogId:t.currentDialog}}),G)((function(e){var a=e.me,t=e.dialogId,n=e.socket,c=e.sendMessage,i=e.addMessage;return r.a.createElement(_e,{inputSubmitHandler:function(e){t&&(i({text:e,isReaded:!1,user:a,createdAt:(new Date).toISOString(),dialog:{_id:t}}),c(e))},handleTyping:function(){n.emit("MESSAGE_TYPING",{user:a,dialogId:t})}})})),he=t(91),ve=(t(438),t(506)),be=function(e){var a=e.blockRef,t=e.isLoading,n=e.typing,c=e.messages,i=e.partnerLastSeen,s=e.partner,o=Object(l.c)((function(e){return e.user.data}));return r.a.createElement("div",{className:"dialog"},r.a.createElement("div",{className:"dialog__header"},r.a.createElement("div",{className:"dialog__header-center"},r.a.createElement("b",{className:"dialog__header-username"},s.fullname),r.a.createElement("div",{className:"dialog__header-status"},s.last_seen&&r.a.createElement("div",{className:f()("status",{"status--online":s.isOnline})},s.isOnline?"\u043e\u043d\u043b\u0430\u0439\u043d":"\u0431\u044b\u043b(\u0430) \u0432 \u0441\u0435\u0442\u0438 ".concat(i))))),r.a.createElement("div",{ref:a,className:"dialog__messages"},function(e,a,t){return e||!t?r.a.createElement(ve.a,{tip:"\u0417\u0430\u0433\u0440\u0443\u0437\u043a\u0430 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439...",size:"large"}):a?0===a.length?r.a.createElement(he.a,{description:"\u0414\u0438\u0430\u043b\u043e\u0433 \u043f\u0443\u0441\u0442"}):a.map((function(e,a){return r.a.createElement(fe,{key:a,avatar:e.user.avatar,text:e.text,date:e.createdAt,attachments:e.attachments,user:e.user,isMe:e.user._id===t._id,isReaded:e.isReaded})})):r.a.createElement(he.a,{description:"\u041e\u0442\u043a\u0440\u043e\u0439\u0442\u0435 \u0434\u0438\u0430\u043b\u043e\u0433"})}(t,c,o),c&&r.a.createElement(fe,{isTyping:n,user:s,avatar:s.avatar,isMe:!1})),r.a.createElement("div",{className:"dialog__input"},r.a.createElement(pe,null)))},Se=t(256),Oe=t.n(Se),De=Object(l.b)((function(e){var a=e.currentDialog,t=e.dialogs,n=e.user;return{me:n.data,socket:n.socket,dialogId:a.currentDialog,dialogs:t.dialogs,messages:a.items,isLoading:a.loading}}),Object(Y.a)(Object(Y.a)({},G),U))((function(e){var a=e.me,t=e.isLoading,c=e.socket,i=e.dialogId,l=e.dialogs,s=e.messages,o=e.fetchMessages,u=e.addMessage,d=e.updateIsReaded,m=Object(n.useState)({}),E=Object(q.a)(m,2),f=E[0],g=E[1],_=Object(n.useState)(!1),p=Object(q.a)(_,2),h=p[0],v=p[1],b=Object(n.useState)(),S=Object(q.a)(b,2),O=S[0],D=S[1],j=Object(n.useRef)(null),A=Object(n.useRef)(null),T=Object(n.useRef)(null);Object(n.useEffect)((function(){if(a&&l&&i){var e=l.filter((function(e){return e._id===i}))[0],t=e.author,n=e.partner;g(t._id===a._id?n:t)}}),[l,i,a]),Object(n.useEffect)((function(){return clearInterval(A.current),Oe()(f)||f.isOnline||(D(Object(K.a)(new Date(f.last_seen),{addSuffix:!0,locale:Z.a})),A.current=setInterval((function(){D(Object(K.a)(new Date(f.last_seen),{addSuffix:!0,locale:Z.a}))}),6e4)),function(){clearInterval(A.current)}}),[l,f]);var N=function(e){i&&e===f._id&&D(Object(K.a)(new Date(f.last_seen),{addSuffix:!0,locale:Z.a}))},y=function(e){var t=e.dialog_id,n=e.partner_id;a&&i===t&&n===a._id&&d(t)},R=function(e){if(i&&a&&i===e.dialog._id&&a&&e.user._id!==a._id){v(!1),clearTimeout(T.current),u(e);var t=l.filter((function(e){return e._id===i}))[0],n=t.author,r=t.partner;r=n._id===a._id?r:n,c.emit("DIALOG_ENTERED",{dialog_id:i,partner_id:r._id})}},C=function(e){var t=e.user,n=e.dialogId;a._id===t._id||i!==n||h||(clearTimeout(T.current),v(!0),j.current&&j.current.scrollTo(0,9999999),T.current=setTimeout((function(){v(!1)}),2e3))};return Object(n.useEffect)((function(){return i&&o(i),c.on("SERVER:MESSAGE_CREATED",R),c.on("MESSAGE_TYPING",C),c.on("SERVER:MESSAGES_READED",y),c.on("USER_DISCONNECTED",N),function(){c.removeListener("SERVER:MESSAGE_CREATED",R),c.removeListener("USER_DISCONNECTED",N),c.removeListener("MESSAGE_TYPING",C),c.removeListener("SERVER:MESSAGE_READED",y)}}),[i,f,a]),Object(n.useEffect)((function(){j.current&&j.current.scrollTo(0,9999999)}),[s]),r.a.createElement(be,{partner:f,blockRef:j,typing:h,partnerLastSeen:O,isLoading:t,messages:s})})),je=(t(441),t(519)),Ae=t(520),Te=t(518),Ne=t(511),ye=t(512),Re=t(510),Ce=t(257),we=t(516),ke=t(507),Ie=t(509),Le=(t(442),function(e){var a,t=e.id,c=e.partner,i=e.unreaded,s=e.isTyping,o=e.lastMessage,u=e.user,d=void 0===u?o.user:u,m=e.onSelect,E=Object(l.c)((function(e){return e.user.data})),g=Object(n.useState)(!1),_=Object(q.a)(g,2),p=_[0],h=_[1];return Object(n.useEffect)((function(){E&&d&&h(E._id===d._id)}),[E,d]),r.a.createElement("div",{onClick:m.bind(void 0,t),className:f()("dialogs__item",{"dialogs__item--online":c.isOnline})},r.a.createElement("div",{className:"dialogs__item-avatar"},r.a.createElement(ce,{avatarSrc:c.avatar,hash:c._id,username:c.fullname})),r.a.createElement("div",{className:"dialogs__item-info"},r.a.createElement("div",{className:"dialogs__item-info-top"},r.a.createElement("b",{className:"dialogs__username"},c.fullname),r.a.createElement("span",{className:"dialogs__date"},(a=o.createdAt,Object(we.a)(Object(ke.a)(a))?Object(Ie.a)(new Date(a),"kk:mm"):Object(Ie.a)(new Date(a),"d.MM.yy")))),r.a.createElement("div",{className:"dialogs__item-info-bottom"},r.a.createElement("p",{className:"dialogs__text"},s?"\u043f\u0435\u0447\u0430\u0442\u0430\u0435\u0442...":"".concat(p?"You":c.fullname,": ").concat(o.text))),p?r.a.createElement(ee,{className:"dialogs__readed-icon",isReaded:o.isReaded}):"",!p&&i?r.a.createElement("div",{className:"dialogs__count"},i):""))}),Me=t(258),Ue=t.n(Me),Ge=(t(470),function(e){var a=e.dialogs,t=e.me,n=e.onSelectDialog;return t?a.length?Ue()(a,(function(e){return e.lastMessage.createdAt}),["desc"]).map((function(e){var a=t._id===e.partner._id?e.author:e.partner;return r.a.createElement(Le,{onSelect:n,partner:a,isTyping:e.isTyping||!1,key:e._id,id:e._id,lastMessage:e.lastMessage,unreaded:e.unreaded})})):r.a.createElement(he.a,{image:he.a.PRESENTED_IMAGE_SIMPLE,imageStyle:{height:80},description:"\u0414\u0438\u0430\u043b\u043e\u0433\u0438 \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d\u044b"}):r.a.createElement(ve.a,{size:"large"})}),xe=function(e){var a=e.me,t=e.dialogs,n=e.onSearch,c=e.inputValue,i=e.onSelectDialog;return r.a.createElement("div",{className:"dialogs"},r.a.createElement("div",{className:"dialogs__search"},r.a.createElement(d.a.Search,{onChange:function(e){return n(e.target.value.toLowerCase())},placeholder:"\u041f\u043e\u0438\u0441\u043a \u0441\u0440\u0435\u0434\u0438 \u043a\u043e\u043d\u0442\u0430\u043a\u0442\u043e\u0432",size:"large",value:c})),r.a.createElement(Ge,{dialogs:t,me:a,onSelectDialog:i}))},Pe=Object(l.b)((function(e){var a=e.user,t=e.dialogs.dialogs,n=e.currentDialog.currentDialog;return{dialogs:t,socket:a.socket,currentDialogId:n,me:a.data}}),U)((function(e){var a=e.me,t=e.dialogs,c=e.socket,i=e.currentDialogId,l=e.updateLastMessage,s=e.updateLastMessageReaded,o=e.setCurrentDialog,u=e.fetchDialogs,d=e.addDialog,m=e.updateUnreadedCount,E=e.setPartnerStatus,f=Object(n.useState)(),g=Object(q.a)(f,2),_=g[0],p=g[1],h=Object(n.useState)(t),v=Object(q.a)(h,2),b=v[0],S=v[1],O=Object(n.useRef)(null);Object(n.useEffect)((function(){t.length?S(t):u()}),[t]);var D=function(e){if(y(!1,e.dialog._id),clearTimeout(O.current),i!==e.dialog._id&&a._id!==e.user._id){var n,r=Object(Ce.a)(t);try{for(r.s();!(n=r.n()).done;){n.value._id===e.dialog._id&&m(e.dialog._id,e.dialog.unreaded++)}}catch(c){r.e(c)}finally{r.f()}}(a&&e.dialog.author===a._id||e.dialog.partner===a._id)&&l(e.dialog._id,e)},j=function(e){var t=e.dialog_id,n=e.partner_id;a&&n===a._id&&s(t)},A=function(e){a&&a._id===e.partner._id&&d(e)},T=function(e){E(e,!0)},N=function(e){E(e,!1)},y=function(e,a){S(b.map((function(t){return a===t._id&&(t.isTyping=e),t})))},R=function(e){var t=e.user,n=e.dialogId;a&&a._id!==t._id&&(clearTimeout(O.current),y(!0,n),O.current=setTimeout((function(){y(!1,n)}),2e3))};return Object(n.useEffect)((function(){return c.on("USER_CONNECTED",T),c.on("USER_DISCONNECTED",N),c.on("SERVER:DIALOG_CREATED",A),c.on("SERVER:MESSAGE_CREATED",D),c.on("SERVER:MESSAGES_READED",j),function(){c.removeListener("USER_CONNECTED",T),c.removeListener("USER_DISCONNECTED",N),c.removeListener("SERVER:MESSAGE_CREATED",D),c.removeListener("SERVER:MESSAGE_READED",j),c.removeListener("SERVER:DIALOG_CREATED",A)}}),[a,i]),Object(n.useEffect)((function(){return c.on("MESSAGE_TYPING",R),function(){c.removeListener("MESSAGE_TYPING",R)}}),[a,t]),r.a.createElement(xe,{me:a,dialogs:b,onSearch:function(e){S(t.filter((function(t){return t[a._id===t.partner._id?"author":"partner"].fullname.toLowerCase().indexOf(e)>=0}))),p(e)},inputValue:_,onSelectDialog:o})})),Ve=function(e){var a=e.modalHandleOk,t=e.showModal,n=e.modalHandleCancel,c=e.modalState,i=e.usersHandleChange,l=e.usersHandleSearch,s=e.usersSearchState,o=e.message,u=e.messageHandleChange,E=e.logout,f=c.visible,g=c.confirmLoading,_=s.value,p=s.fetching,h=s.data.map((function(e){return r.a.createElement(Ne.a.Option,{key:e._id},e.fullname)}));return r.a.createElement("div",{className:"sidebar"},r.a.createElement("div",{className:"sidebar__header"},r.a.createElement("div",null,r.a.createElement(je.a,{style:{fontSize:"18px"}}),r.a.createElement("span",null,"\u0421\u043f\u0438\u0441\u043e\u043a \u0434\u0438\u0430\u043b\u043e\u0433\u043e\u0432")),r.a.createElement("div",null,r.a.createElement(ye.a,{title:"\u0421\u043e\u0437\u0434\u0430\u0442\u044c \u0434\u0438\u0430\u043b\u043e\u0433"},r.a.createElement(m.a,{onClick:t,className:"ant-btn--no-border",form:"circle",icon:r.a.createElement(Ae.a,{style:{fontSize:"18px"}})})),r.a.createElement(Re.a,{title:"\u0421\u043e\u0437\u0434\u0430\u043d\u0438\u0435 \u0434\u0438\u0430\u043b\u043e\u0433\u0430",visible:f,onCancel:n,footer:[r.a.createElement(m.a,{key:"back",onClick:n},"\u041e\u0442\u043c\u0435\u043d\u0430"),r.a.createElement(m.a,{disabled:!_||!o,key:"submit",type:"primary",loading:g,onClick:a},"\u0421\u043e\u0437\u0434\u0430\u0442\u044c")]},r.a.createElement(Ne.a,{showSearch:!0,value:_,placeholder:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 username \u0438\u043b\u0438 e-mail \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f",style:{width:"100%"},defaultActiveFirstOption:!1,notFoundContent:p?r.a.createElement(ve.a,{size:"small"}):r.a.createElement("span",null,"\u041f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0438 \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d\u044b"),showArrow:!1,filterOption:!1,onSearch:l,onChange:i},h),r.a.createElement("div",{style:{marginTop:"15px"}},r.a.createElement(d.a.TextArea,{value:o,placeholder:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435",autoSize:{minRows:3,maxRows:5},onChange:u}))),r.a.createElement(ye.a,{title:"\u0412\u044b\u0439\u0442\u0438 \u0438\u0437 \u0430\u043a\u043a\u0430\u0443\u043d\u0442\u0430"},r.a.createElement(m.a,{onClick:E,className:"ant-btn--no-border",form:"circle",icon:r.a.createElement(Te.a,{style:{fontSize:"18px"}})})))),r.a.createElement("div",{className:"sidebar__dialogs"},r.a.createElement(Pe,null)))},ze=Object(l.b)((function(e){return e}),Object(Y.a)(Object(Y.a)(Object(Y.a)({},U),x),G))(Object(o.g)((function(e){var a=e.createDialog,t=e.clearUserData,c=e.clearCurrentDialog,i=e.clearDialogs,l=e.history,s=Object(n.useState)({data:[],fetching:!1,value:void 0}),o=Object(q.a)(s,2),u=o[0],d=o[1],m=Object(n.useState)({visible:!1,confirmLoading:!1}),E=Object(q.a)(m,2),f=E[0],g=E[1],_=Object(n.useState)(""),p=Object(q.a)(_,2),h=p[0],v=p[1];return r.a.createElement(Ve,{showModal:function(){g(Object(Y.a)(Object(Y.a)({},f),{},{visible:!0}))},modalHandleCancel:function(){g(Object(Y.a)(Object(Y.a)({},f),{},{visible:!1}))},modalHandleOk:function(){u.value&&(g(Object(Y.a)(Object(Y.a)({},f),{},{confirmLoading:!0})),a(u.value,h).then((function(){g({visible:!1,confirmLoading:!1}),d({data:[],fetching:!1,value:void 0}),v("")})))},modalState:f,usersHandleSearch:function(e){e?(d(Object(Y.a)(Object(Y.a)({},u),{},{fetching:!0})),R(e).then((function(e){200===e.status&&d(Object(Y.a)(Object(Y.a)({},u),{},{fetching:!1,data:e.data}))})).catch((function(e){d(Object(Y.a)(Object(Y.a)({},u),{},{fetching:!1}))}))):d(Object(Y.a)(Object(Y.a)({},u),{},{data:[]}))},usersHandleChange:function(e){d(Object(Y.a)(Object(Y.a)({},u),{},{value:e}))},usersSearchState:u,messageHandleChange:function(e){var a=e.target.value;v(a)},message:h,logout:function(){t(),c(),i(),l.push("/login")}})}))),He=function(){return r.a.createElement("section",{className:"home"},r.a.createElement("div",{className:"chat"},r.a.createElement("div",{className:"chat__sidebar"},r.a.createElement(ze,null)),r.a.createElement("div",{className:"chat__dialog"},r.a.createElement("div",{className:"chat__dialog-messages"},r.a.createElement(De,null)))))};var Fe=Object(l.b)((function(e){var a=e.user;return{isAuth:a.isAuth,token:a.token,me:a.data}}),x)((function(e){var a=e.me,t=e.isAuth,c=e.token,i=e.fetchUserData;return Object(n.useEffect)((function(){c&&!a&&i(c)}),[a]),r.a.createElement("div",{className:"wrapper"},r.a.createElement(s.a,null,r.a.createElement(o.d,null,r.a.createElement(o.b,{exact:!0,path:"/",render:function(){return t?r.a.createElement(o.a,{to:"/im"}):r.a.createElement(o.a,{to:"/login"})}}),r.a.createElement(o.b,{exact:!0,path:["/login","/register"],render:function(){return t?r.a.createElement(o.a,{to:"/im"}):r.a.createElement(B,null)}}),r.a.createElement(o.b,{exact:!0,path:"/im",render:function(){return t?r.a.createElement(He,null):r.a.createElement(o.a,{to:"/login"})}}))))}));Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var Be=t(64),Ye=t(142),qe={dialogs:[]},Ke={DIALOGS_SET_ITEMS:function(e,a){return Object(Y.a)(Object(Y.a)({},e),{},{dialogs:a})},CLEAR_DIALOGS:function(){return qe},ADD_DIALOG:function(e,a){return Object(Y.a)(Object(Y.a)({},e),{},{dialogs:[].concat(Object(Ye.a)(e.dialogs),[a])})},UPDATE_LAST_MESSAGE:function(e,a){var t=a.dialogId,n=a.message;return Object(Y.a)(Object(Y.a)({},e),{},{dialogs:e.dialogs.map((function(e){return t===e._id&&(e.lastMessage=n),e}))})},UPDATE_LAST_MESSAGE_READED:function(e,a){return Object(Y.a)(Object(Y.a)({},e),{},{dialogs:e.dialogs.map((function(e){return a===e._id&&(e.lastMessage.isReaded=!0),e}))})},UPDATE_UNREADED_COUNT:function(e,a){var t=a.dialogId,n=a.unreadedCount;return Object(Y.a)(Object(Y.a)({},e),{},{dialogs:e.dialogs.map((function(e){return t===e._id&&(e.unreaded=n),e}))})},SET_PARTNER_STATUS:function(e,a){var t=a.partnerId,n=a.isOnline;return Object(Y.a)(Object(Y.a)({},e),{},{dialogs:e.dialogs.map((function(e){return t===e.author._id&&(e.author.isOnline=n,e.author.last_seen=(new Date).toISOString()),t===e.partner._id&&(e.partner.isOnline=n,e.partner.last_seen=(new Date).toISOString()),e}))})},DEFAULT:function(e){return e}},Ze={items:null,loading:!1,currentDialog:null},$e={SET_LOADING:function(e,a){return Object(Y.a)(Object(Y.a)({},e),{},{loading:a})},SET_CURRENT_DIALOG:function(e,a){return Object(Y.a)(Object(Y.a)({},e),{},{loading:!1,items:a})},CLEAR_CURRENT_DIALOG:function(){return Ze},ADD_MESSAGE:function(e,a){return Object(Y.a)(Object(Y.a)({},e),{},{items:[].concat(Object(Ye.a)(e.items),[a])})},SET_CURRENT_DIALOG_ID:function(e,a){return Object(Y.a)(Object(Y.a)({},e),{},{currentDialog:a})},UPDATE_IS_READED:function(e,a){var t=a.dialogId,n=a.myId;return Object(Y.a)(Object(Y.a)({},e),{},{items:e.items.map((function(e){return e.dialog._id===t&&e.user._id===n&&(e.isReaded=!0),e}))})},DEFAULT:function(e){return e}},Je={data:null,token:window.localStorage.token||"",socket:M.a.connect("http://localhost:3003",{query:{token:window.localStorage.token||""}})},We={USER_SET_DATA:function(e,a){return Object(Y.a)(Object(Y.a)({},e),{},{data:a})},CLEAR_USER_DATA:function(){return{data:null,token:"",socket:null,isAuth:!1}},SOCKET_CREATE_CONNECTION:function(e,a){return Object(Y.a)(Object(Y.a)({},e),{},{socket:a})},SET_TOKEN:function(e,a){return Object(Y.a)(Object(Y.a)({},e),{},{token:a})},SET_IS_AUTH:function(e,a){return Object(Y.a)(Object(Y.a)({},e),{},{isAuth:a})},DEFAULT:function(e){return e}},Xe=Object(Be.c)({dialogs:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:qe,a=arguments.length>1?arguments[1]:void 0,t=a.type,n=a.payload,r=Ke[t]||Ke.DEFAULT;return r(e,n)},currentDialog:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Ze,a=arguments.length>1?arguments[1]:void 0,t=a.type,n=a.payload,r=$e[t]||$e.DEFAULT;return r(e,n)},user:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Je,a=arguments.length>1?arguments[1]:void 0,t=a.type,n=a.payload,r=We[t]||We.DEFAULT;return r(e,n)}}),Qe=t(263),ea=window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__||Be.d,aa=[Qe.a],ta=Object(Be.e)(Xe,ea(Be.a.apply(void 0,aa)));i.a.render(r.a.createElement(l.a,{store:ta},r.a.createElement(Fe,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[271,1,2]]]);
//# sourceMappingURL=main.ab814627.chunk.js.map