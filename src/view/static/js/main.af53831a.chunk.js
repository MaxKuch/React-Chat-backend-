(this.webpackJsonpchat=this.webpackJsonpchat||[]).push([[0],{251:function(e,a,t){e.exports=t.p+"static/media/readed.c1f419d6.svg"},252:function(e,a,t){e.exports=t.p+"static/media/noreaded.3c841bf6.svg"},269:function(e,a,t){e.exports=t(502)},274:function(e,a,t){},279:function(e,a,t){},280:function(e,a,t){},301:function(e,a,t){},429:function(e,a){},432:function(e,a,t){},433:function(e,a,t){},434:function(e,a,t){},435:function(e,a,t){},436:function(e,a,t){},439:function(e,a,t){},440:function(e,a,t){},468:function(e,a,t){},502:function(e,a,t){"use strict";t.r(a);var n=t(0),r=t.n(n),c=t(9),i=t.n(c),l=(t(274),t(275),t(20)),o=t(48),s=t(16),u=(t(279),t(506)),d=t(510),m=t(265),E=t(65),g=(t(280),t(1)),f=t.n(g),_=function(e){var a=e.className,t=e.size,n=e.disabled,c=Object(m.a)(e,["className","size","disabled"]);return r.a.createElement(E.a,Object.assign({disabled:n,className:f()("button",a,{"button--large":"large"===t})},c))},p=(t(301),function(e){var a=e.children,t=e.className;return r.a.createElement("div",{className:f()("block",t)}," ",a," ")}),h=function(e,a){return e?a&&e?"error":"success":""},v={labelCol:{span:0},wrapperCol:{span:25}},b=function(e){e.values;var a=e.errors,t=e.touched,n=e.handleChange,c=e.handleBlur,i=e.handleSubmit,l=e.isSubmitting,s=e.isValid;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"auth__top"},r.a.createElement("h2",null,"\u0412\u043e\u0439\u0442\u0438 \u0432 \u0430\u043a\u043a\u0430\u0443\u043d\u0442"),r.a.createElement("p",null,"\u041f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430, \u0432\u043e\u0439\u0434\u0438\u0442\u0435 \u0432 \u0441\u0432\u043e\u0439 \u0430\u043a\u043a\u0430\u0443\u043d\u0442")),r.a.createElement(p,null,r.a.createElement(u.a,Object.assign({},v,{onFinish:function(){i()}}),r.a.createElement(u.a.Item,{name:"email",help:t.email&&a.email,onChange:n,onBlur:c,validateStatus:h(t.email,a.email),hasFeedback:!0,rules:[{required:!0,message:"Please input your E-Mail"}]},r.a.createElement(d.a,{size:"large",placeholder:"E-Mail"})),r.a.createElement(u.a.Item,{name:"password",help:t.password&&a.password,onChange:n,onBlur:c,validateStatus:h(t.password,a.password),hasFeedback:!0,rules:[{required:!0,message:"Please input your password"}]},r.a.createElement(d.a.Password,{size:"large",placeholder:"Password"})),r.a.createElement(u.a.Item,null,l&&!s&&r.a.createElement("span",null,"\u041e\u0448\u0438\u0431\u043a\u0430!"),r.a.createElement(_,{disabled:l,size:"large",type:"primary",htmlType:"submit"},"\u0412\u043e\u0439\u0442\u0438 \u0432 \u0430\u043a\u043a\u0430\u0443\u043d\u0442"))),r.a.createElement(o.b,{className:"auth__register-link",to:"/register"},"\u0417\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u0442\u044c\u0441\u044f")))},S=t(139),O=function(e){var a=e.isAuth,t=e.values,n=e.errors,r={email:function(e){e?/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,}$/i.test(e)||(n.email="\u041d\u0435\u0432\u0435\u0440\u043d\u044b\u0439 E-Mail"):n.email="\u0412\u0432\u0435\u0434\u0438\u0442\u0435 E-Mail"},name:function(e){e?e.length<2&&(n.name="\u0418\u043c\u044f \u0434\u043e\u043b\u0436\u043d\u043e \u0441\u043e\u0431\u0435\u0440\u0436\u0430\u0442\u044c \u043d\u0435 \u043c\u0435\u043d\u0435\u0435 \u0434\u0432\u0443\u0445 \u0441\u0438\u043c\u0432\u043e\u043b\u043e\u0432"):n.name="\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0432\u0430\u0448\u0435 \u0438\u043c\u044f"},password:function(e){e?a||/^(?=.*\d)(?=.*[a-z])(?=.*[A-Z])(?=.*[a-zA-Z]).{8,}$/i.test(e)||(n.password="\u0421\u043b\u0438\u0448\u043a\u043e\u043c \u043b\u0435\u0433\u043a\u0438\u0439 \u043f\u0430\u0440\u043e\u043b\u044c"):n.password="\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u043f\u0430\u0440\u043e\u043b\u044c"},repeatPassword:function(e){e?e!==t.password&&(n.repeatPassword="\u041f\u0430\u0440\u043e\u043b\u0438 \u043d\u0435 \u0441\u043e\u0432\u043f\u0430\u0434\u0430\u044e\u0442"):n.repeatPassword="\u041f\u043e\u0432\u0442\u043e\u0440\u0438\u0442\u0435 \u043f\u0430\u0440\u043e\u043b\u044c"}};Object.keys(t).forEach((function(e){return r[e]&&r[e](t[e])}))},D=t(248),A={API_URL:"http://localhost",API_PORT:"3003"},j=t.n(D).a.create({baseURL:"".concat(A.API_URL,":").concat(A.API_PORT)}),T=function(){return j.get("/dialogs",{headers:{token:window.localStorage.token}})},R=function(e,a,t){return j.post("/dialogs",{author:e,partner:a,text:t},{headers:{token:window.localStorage.token}})},N=function(e,a){return j.post("/messages/",{text:e,dialog:a},{headers:{token:window.localStorage.token}})},y=function(e){return j.get("/messages/".concat(e))},C=function(e){return j.post("/user/login",e)},I=function(e){return j.get("/user/find?query=".concat(e),{headers:{token:window.localStorage.token}})},w=function(e){return j.get("/user/me",{headers:{token:e}})},k=function(e){return j.post("/user/registration",e)},L=t(513),U=function(e){var a=e.text,t=e.title,n=e.type,r=void 0===n?"info":n;return L.a[r]({message:t,description:a})},M=t(133),P=t.n(M),G={setDialogs:function(e){return{type:"DIALOGS_SET_ITEMS",payload:e}},addDialog:function(e){return{type:"ADD_DIALOG",payload:e}},clearDialogs:function(){return{type:"CLEAR_DIALOGS"}},setPartnerStatus:function(e,a){return{type:"SET_PARTNER_STATUS",payload:{partnerId:e,isOnline:a}}},updateUnreadedCount:function(e,a){return{type:"UPDATE_UNREADED_COUNT",payload:{dialogId:e,unreadedCount:a}}},setCurrentDialog:function(e){return function(a,t){var n=t(),r=n.user,c=r.data,i=r.socket,l=n.dialogs.dialogs.filter((function(a){return a._id===e}))[0],o=c._id===l.author._id?l.partner._id:l.author._id;i.emit("DIALOG_ENTERED",{dialog_id:e,partner_id:o}),a(G.updateUnreadedCount(l._id,0)),a({type:"SET_CURRENT_DIALOG_ID",payload:e})}},updateLastMessage:function(e,a){return{type:"UPDATE_LAST_MESSAGE",payload:{dialogId:e,message:a}}},updateLastMessageReaded:function(e){return{type:"UPDATE_LAST_MESSAGE_READED",payload:e}},createDialog:function(e,a){return function(t,n){var r=n().user.data;return R(r._id,e,a).then((function(e){var a=e.data;t(G.addDialog(a))}))}},fetchDialogs:function(){return function(e){return T().then((function(a){var t=a.data;t.length&&e(G.setDialogs(t))}))}}},x={setMessages:function(e){return{type:"SET_CURRENT_DIALOG",payload:e}},clearCurrentDialog:function(){return{type:"CLEAR_CURRENT_DIALOG"}},addMessage:function(e){return{type:"ADD_MESSAGE",payload:e}},updateIsReaded:function(e,a){return function(a,t){var n=t().user.data;a({type:"UPDATE_IS_READED",payload:{dialogId:e,myId:n._id}})}},sendMessage:function(e){return function(a,t){var n=t().currentDialog.currentDialog;N(e,n)}},setLoading:function(e){return{type:"SET_LOADING",payload:e}},fetchMessages:function(e){return function(a){a(x.setLoading(!0)),y(e).then((function(e){var t=e.data;a(x.setMessages(t||null))}))}}},V={setUserData:function(e){return{type:"USER_SET_DATA",payload:e}},clearUserData:function(){return function(e,a){a().user.socket.disconnect(),window.localStorage.clear(),e({type:"CLEAR_USER_DATA"})}},setToken:function(e){return{type:"SET_TOKEN",payload:e}},setIsAuth:function(e){return{type:"SET_IS_AUTH",payload:e}},socketCreateConnection:function(e){return{type:"SOCKET_CREATE_CONNECTION",payload:P.a.connect("".concat(A.API_URL,":").concat(A.API_PORT),{query:{token:e}})}},fetchUserData:function(e){return function(a){w(e).then((function(e){var t=e.data;a(V.setUserData(t))}))}},fetchUserLogin:function(e){return function(a,t){return C(e).then((function(e){var n=e.data,r=n.status,c=n.token;if("error"===r)U({text:"\u041d\u0435\u0432\u0435\u0440\u043d\u044b\u0439 \u043b\u043e\u0433\u0438\u043d \u0438\u043b\u0438 \u043f\u0430\u0440\u043e\u043b\u044c",title:"\u041e\u0448\u0438\u0431\u043a\u0430 \u043f\u0440\u0438 \u0430\u0432\u0442\u043e\u0440\u0438\u0437\u0430\u0446\u0438\u0438",type:"error"});else{U({title:"\u041e\u0442\u043b\u0438\u0447\u043d\u043e!",text:"\u0410\u0432\u0442\u043e\u0440\u0438\u0437\u0430\u0446\u0438\u044f \u0443\u0441\u043f\u0435\u0448\u043d\u0430",type:"success"}),window.localStorage.token=c;t().user.socket;a(V.socketCreateConnection(c)),a(V.setToken(c)),a(V.setIsAuth(!0)),a(V.fetchUserData(c))}return r}))}},fetchUserRegistration:function(e){return function(a,t){return k(e).then((function(e){var n=e.data,r=n.status,c=n.token;"error"===r?U({text:"\u041e\u0448\u0438\u0431\u043a\u0430 \u043f\u0440\u0438 \u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u0438",title:"\u0423\u043f\u0441",type:"error"}):(U({title:"\u041e\u0442\u043b\u0438\u0447\u043d\u043e!",text:"\u0420\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u044f \u043f\u0440\u043e\u0448\u043b\u0430 \u0443\u0441\u043f\u0435\u0448\u043d\u043e",type:"success"}),window.localStorage.token=c,t().user.socket.disconnect(),a(V.socketCreateConnection(c)),a(V.setToken(c)),a(V.setIsAuth(!0)),a(V.fetchUserData(c)));return r}))}}},z=Object(l.b)((function(e){return e}),V)(Object(s.g)((function(e){var a=e.fetchUserLogin,t=e.history;return r.a.createElement("div",null,r.a.createElement(S.a,{initialValues:{email:"",password:""},validate:function(e){var a={};return O({isAuth:!0,values:e,errors:a}),a},onSubmit:function(e,n){var r=n.setSubmitting;r(!0),a(e).then((function(e){"success"===e?t.push("/"):r(!1)})).catch((function(e){r(!1)}))}},b))}))),H=function(e){var a=e.name,t=e.placeholder,n=e.type,c=e.handleChange,i=e.handleBlur,l=e.touched,o=e.errors,s=e.defaultValue;return r.a.createElement(u.a.Item,{help:l[a]&&o[a],name:a,onChange:c,onBlur:i,validateStatus:h(l[a],o[a]),hasFeedback:!0,defaultValue:s},"password"===n?r.a.createElement(d.a.Password,{size:"large",placeholder:t}):r.a.createElement(d.a,{size:"large",placeholder:t}))},F={labelCol:{span:0},wrapperCol:{span:25}},B=function(e){var a=e.values,t=e.errors,n=e.touched,c=e.handleChange,i=e.handleBlur,l=e.handleSubmit,s=e.setTouched;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"auth__top"},r.a.createElement("h2",null,"\u0417\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u0443\u0439\u0442\u0435\u0441\u044c"),r.a.createElement("p",null,"\u0414\u043b\u044f \u0432\u0445\u043e\u0434\u0430 \u0432 \u0447\u0430\u0442, \u043d\u0443\u0436\u043d\u043e \u0437\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u0442\u044c\u0441\u044f")),r.a.createElement(p,null,r.a.createElement(u.a,Object.assign({},F,{onFinish:function(){l()}}),r.a.createElement(H,{name:"email",placeholder:"E-mail",touched:n,errors:t,handleChange:c,handleBlur:i,defaultValue:a.email}),r.a.createElement(H,{name:"name",placeholder:"\u0412\u0430\u0448\u0435 \u0438\u043c\u044f",touched:n,errors:t,handleChange:c,handleBlur:i,defaultValue:a.name}),r.a.createElement(H,{type:"password",name:"password",placeholder:"\u041f\u0430\u0440\u043e\u043b\u044c",touched:n,errors:t,handleChange:c,handleBlur:i,defaultValue:a.password}),r.a.createElement(H,{type:"password",name:"repeatPassword",placeholder:"\u041f\u043e\u0432\u0442\u043e\u0440\u0438\u0442\u0435 \u043f\u0430\u0440\u043e\u043b\u044c",touched:n,errors:t,handleChange:c,handleBlur:i,defaultValue:a.repeatPassword}),r.a.createElement(u.a.Item,null,r.a.createElement(_,{onClick:function(){s({email:!0,name:!0,password:!0,repeatPassword:!0})},size:"large",type:"primary",htmlType:"submit"},"\u0417\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u0442\u044c\u0441\u044f"))),r.a.createElement(o.b,{className:"auth__register-link",to:"/login"},"\u0412\u043e\u0439\u0442\u0438 \u0432 \u0430\u043a\u043a\u0430\u0443\u043d\u0442")))},q=Object(l.b)((function(e){return e}),V)(Object(s.g)((function(e){var a=e.fetchUserRegistration,t=e.history;return r.a.createElement("div",null,r.a.createElement(S.a,{initialValues:{email:"",name:"",password:"",repeatPassword:""},validate:function(e){var a={};return O({isAuth:!1,values:e,errors:a}),a},onSubmit:function(e,n){var r=n.setSubmitting;a(e).then((function(e){"success"===e?t.push("/"):r(!1)})).catch((function(e){r(!1)}))}},B))}))),K=function(){return r.a.createElement("div",{className:"auth"},r.a.createElement("div",{className:"auth__wrapper"},r.a.createElement(s.d,null,r.a.createElement(s.b,{exact:!0,path:["/","/login"],component:z}),r.a.createElement(s.b,{exact:!0,path:"/register",component:q}))))},Y=(t(432),t(3)),Z=t(23),$=t(250),J=t.n($),W=t(181),X=t(511),Q=(t(433),t(251)),ee=t.n(Q),ae=t(252),te=t.n(ae),ne=function(e){var a=e.isReaded,t=e.className;return r.a.createElement("div",{className:t},r.a.createElement("img",{src:a?ee.a:te.a,alt:""}))},re=t(122),ce=t.n(re),ie=function(e){var a=e.substr(-3,3).split("").map((function(e){return(a=e.charCodeAt())>255?a%255:a<0?-a%255:a;var a})),t=Object(Z.a)(a,3),n=t[0],r=t[1],c=t[2];return{color:ce()({r:n,g:r,b:c}).lighten(10).saturate(20).toHexString(),lightenColor:ce()({r:n,g:r,b:c}).saturate(20).lighten(30).toHexString()}},le=(t(434),function(e){if(e)return e}),oe=function(e){var a=e.avatarSrc,t=e.hash,n=e.username.charAt(0);return r.a.createElement("div",{className:"avatar"},a?r.a.createElement("img",{src:le(a),alt:"User avatar"}):r.a.createElement("div",{className:"avatar__gradient",style:{background:"linear-gradient(\n              115deg, \n              ".concat(ie(t).color,", \n              ").concat(ie(t).lightenColor,"\n            )")}},r.a.createElement("span",null,n)))};oe.defaultProps={username:"none"};var se=oe,ue=function(e){var a=e.avatar,t=e.text,c=e.date,i=e.user,l=e.isMe,o=e.isReaded,s=e.audio,u=e.attachments,d=e.isTyping,m=Object(n.useState)(),E=Object(Z.a)(m,2),g=E[0],_=E[1],p=Object(n.useRef)(null);return Object(n.useEffect)((function(){return clearInterval(p.current),c&&(_(Object(W.a)(new Date(c),{addSuffix:!0,locale:X.a})),p.current=setInterval((function(){_(Object(W.a)(new Date(c),{addSuffix:!0,locale:X.a}))}),6e4)),function(){clearInterval(p.current)}}),[c]),s||t||d||u.length?r.a.createElement("div",{className:f()("message",{"message--isme":l,"message--is-typing":d,"message--image":u&&1===u.length,"message--audio":s})},r.a.createElement("div",{className:"message__wrap"},r.a.createElement("div",{className:"message__avatar"},r.a.createElement(se,{avatarSrc:a,hash:i._id,username:i.fullname})),r.a.createElement("div",null,r.a.createElement("div",{className:"message__content"},(s||t||d)&&r.a.createElement("div",{className:"message__bubble"},r.a.createElement("div",{className:"message__typing"},r.a.createElement("span",null),r.a.createElement("span",null),r.a.createElement("span",null)),t&&r.a.createElement("p",{className:"message__text"},t)),u.length?r.a.createElement("div",{className:"message__attachments"},u.map((function(e,a){return r.a.createElement("div",{key:a,className:"message__attachments-item"},r.a.createElement("img",{src:e.url,alt:e.filename}))}))):""),!d&&r.a.createElement("span",{className:"message__date"},g)),l?r.a.createElement(ne,{className:"message__readed-icon",isReaded:o}):"")):r.a.createElement("div",null)};ue.defaultProps={user:{},attachments:[]};var de=ue,me=(t(435),t(515));var Ee=function(e){var a=e.inputSubmitHandler,t=e.handleTyping,c=Object(n.useState)(),i=Object(Z.a)(c,2),l=i[0],o=i[1];return r.a.createElement("div",{className:"message-input"},r.a.createElement("div",{className:"message-input__textarea"},r.a.createElement(d.a,{onChange:function(e){o(e.target.value)},onKeyUp:function(e){"Enter"===e.key&&e.target.value?(a(l),o("")):t()},placeholder:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0442\u0435\u043a\u0441\u0442 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u044f...",size:"large",value:l})),r.a.createElement("div",{className:"message-input__actions"},r.a.createElement(E.a,{onClick:function(){l&&(a(l),o(""))},className:"ant-btn--no-border",shape:"circle",icon:r.a.createElement(me.a,{style:{fontSize:"20px"}})})))},ge=Object(l.b)((function(e){var a=e.user,t=e.currentDialog;return{me:a.data,socket:a.socket,dialogId:t.currentDialog}}),x)((function(e){var a=e.me,t=e.dialogId,n=e.socket,c=e.sendMessage,i=e.addMessage;return r.a.createElement(Ee,{inputSubmitHandler:function(e){t&&(i({text:e,isReaded:!1,user:a,createdAt:(new Date).toISOString(),dialog:{_id:t}}),c(e))},handleTyping:function(){n.emit("MESSAGE_TYPING",{user:a,dialogId:t})}})})),fe=t(91),_e=(t(436),t(504)),pe=function(e){var a=e.blockRef,t=e.isLoading,n=e.typing,c=e.messages,i=e.partnerLastSeen,o=e.partner,s=Object(l.c)((function(e){return e.user.data}));return r.a.createElement("div",{className:"dialog"},r.a.createElement("div",{className:"dialog__header"},r.a.createElement("div",{className:"dialog__header-center"},r.a.createElement("b",{className:"dialog__header-username"},o.fullname),r.a.createElement("div",{className:"dialog__header-status"},o.last_seen&&r.a.createElement("div",{className:f()("status",{"status--online":o.isOnline})},o.isOnline?"\u043e\u043d\u043b\u0430\u0439\u043d":"\u0431\u044b\u043b(\u0430) \u0432 \u0441\u0435\u0442\u0438 ".concat(i))))),r.a.createElement("div",{ref:a,className:"dialog__messages"},function(e,a,t){return e||!t?r.a.createElement(_e.a,{tip:"\u0417\u0430\u0433\u0440\u0443\u0437\u043a\u0430 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439...",size:"large"}):a?0===a.length?r.a.createElement(fe.a,{description:"\u0414\u0438\u0430\u043b\u043e\u0433 \u043f\u0443\u0441\u0442"}):a.map((function(e,a){return r.a.createElement(de,{key:a,avatar:e.user.avatar,text:e.text,date:e.createdAt,attachments:e.attachments,user:e.user,isMe:e.user._id===t._id,isReaded:e.isReaded})})):r.a.createElement(fe.a,{description:"\u041e\u0442\u043a\u0440\u043e\u0439\u0442\u0435 \u0434\u0438\u0430\u043b\u043e\u0433"})}(t,c,s),c&&r.a.createElement(de,{isTyping:n,user:o,avatar:o.avatar,isMe:!1})),r.a.createElement("div",{className:"dialog__input"},r.a.createElement(ge,null)))};pe.defaultProps={messages:[],partnerLastSeen:"\u043c\u0435\u043d\u044c\u0448\u0435 \u043c\u0438\u043d\u0443\u0442\u044b \u043d\u0430\u0437\u0430\u0434"};var he=pe,ve=Object(l.b)((function(e){var a=e.currentDialog,t=e.dialogs,n=e.user;return{me:n.data,socket:n.socket,dialogId:a.currentDialog,dialogs:t.dialogs,messages:a.items,isLoading:a.loading}}),Object(Y.a)(Object(Y.a)({},x),G))((function(e){var a=e.me,t=e.isLoading,c=e.socket,i=e.dialogId,l=e.dialogs,o=e.messages,s=e.fetchMessages,u=e.addMessage,d=e.updateIsReaded,m=Object(n.useState)({}),E=Object(Z.a)(m,2),g=E[0],f=E[1],_=Object(n.useState)(!1),p=Object(Z.a)(_,2),h=p[0],v=p[1],b=Object(n.useState)(),S=Object(Z.a)(b,2),O=S[0],D=S[1],A=Object(n.useRef)(null),j=Object(n.useRef)(null),T=Object(n.useRef)(null);Object(n.useEffect)((function(){if(a&&l&&i){var e=l.filter((function(e){return e._id===i}))[0],t=e.author,n=e.partner;f(t._id===a._id?n:t)}}),[l,i,a]),Object(n.useEffect)((function(){return clearInterval(j.current),J()(g)||g.isOnline||(D(Object(W.a)(new Date(g.last_seen),{addSuffix:!0,locale:X.a})),j.current=setInterval((function(){D(Object(W.a)(new Date(g.last_seen),{addSuffix:!0,locale:X.a}))}),6e4)),function(){clearInterval(j.current)}}),[l,g]),Object(n.useEffect)((function(){return i&&s(i),c.on("SERVER:MESSAGE_CREATED",y),c.on("MESSAGE_TYPING",C),c.on("SERVER:MESSAGES_READED",N),c.on("USER_DISCONNECTED",R),function(){c.removeListener("SERVER:MESSAGE_CREATED",y),c.removeListener("USER_DISCONNECTED",R),c.removeListener("MESSAGE_TYPING",C),c.removeListener("SERVER:MESSAGE_READED",N)}}),[i,g,a]),Object(n.useEffect)((function(){A.current&&A.current.scrollTo(0,9999999)}),[o]);var R=function(e){i&&e===g._id&&D(Object(W.a)(new Date(g.last_seen),{addSuffix:!0,locale:X.a}))},N=function(e){var t=e.dialog_id,n=e.partner_id;a&&i===t&&n===a._id&&d(t)},y=function(e){if(i&&a&&i===e.dialog._id&&a&&e.user._id!==a._id){v(!1),clearTimeout(T.current),u(e);var t=l.filter((function(e){return e._id===i}))[0],n=t.author,r=t.partner;r=n._id===a._id?r:n,c.emit("DIALOG_ENTERED",{dialog_id:i,partner_id:r._id})}},C=function(e){var t=e.user,n=e.dialogId;a._id===t._id||i!==n||h||(clearTimeout(T.current),v(!0),A.current&&A.current.scrollTo(0,9999999),T.current=setTimeout((function(){v(!1)}),2e3))};return r.a.createElement(he,{partner:g,blockRef:A,typing:h,partnerLastSeen:O,isLoading:t,messages:o})})),be=(t(439),t(517)),Se=t(518),Oe=t(516),De=t(509),Ae=t(512),je=t(508),Te=t(254),Re=t(514),Ne=t(505),ye=t(507),Ce=(t(440),function(e){var a,t=e.id,c=e.partner,i=e.unreaded,o=e.isTyping,s=e.lastMessage,u=e.user,d=void 0===u?s.user:u,m=e.onSelect,E=Object(l.c)((function(e){return e.user.data})),g=Object(n.useState)(!1),_=Object(Z.a)(g,2),p=_[0],h=_[1];return Object(n.useEffect)((function(){E&&d&&h(E._id===d._id)}),[E,d]),r.a.createElement("div",{onClick:m.bind(void 0,t),className:f()("dialogs__item",{"dialogs__item--online":c.isOnline})},r.a.createElement("div",{className:"dialogs__item-avatar"},r.a.createElement(se,{avatarSrc:c.avatar,hash:c._id,username:c.fullname})),r.a.createElement("div",{className:"dialogs__item-info"},r.a.createElement("div",{className:"dialogs__item-info-top"},r.a.createElement("b",{className:"dialogs__username"},c.fullname),r.a.createElement("span",{className:"dialogs__date"},(a=s.createdAt,Object(Re.a)(Object(Ne.a)(a))?Object(ye.a)(new Date(a),"kk:mm"):Object(ye.a)(new Date(a),"d.MM.yy")))),r.a.createElement("div",{className:"dialogs__item-info-bottom"},r.a.createElement("p",{className:"dialogs__text"},o?"\u043f\u0435\u0447\u0430\u0442\u0430\u0435\u0442...":"".concat(p?"\u0412\u044b":c.fullname,": ").concat(s.text))),p?r.a.createElement(ne,{className:"dialogs__readed-icon",isReaded:s.isReaded}):"",!p&&i?r.a.createElement("div",{className:"dialogs__count"},i):""))}),Ie=t(255),we=t.n(Ie),ke=(t(468),function(e){var a=e.dialogs,t=e.me,n=e.onSelectDialog;return t?a.length?we()(a,(function(e){return e.lastMessage.createdAt}),["desc"]).map((function(e){var a=t._id===e.partner._id?e.author:e.partner;return r.a.createElement(Ce,{onSelect:n,partner:a,isTyping:e.isTyping||!1,key:e._id,id:e._id,lastMessage:e.lastMessage,unreaded:e.unreaded})})):r.a.createElement(fe.a,{image:fe.a.PRESENTED_IMAGE_SIMPLE,imageStyle:{height:80},description:"\u0414\u0438\u0430\u043b\u043e\u0433\u0438 \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d\u044b"}):r.a.createElement(_e.a,{size:"large"})}),Le=function(e){var a=e.me,t=e.dialogs,n=e.onSearch,c=e.inputValue,i=e.onSelectDialog;return r.a.createElement("div",{className:"dialogs"},r.a.createElement("div",{className:"dialogs__search"},r.a.createElement(d.a.Search,{onChange:function(e){return n(e.target.value.toLowerCase())},placeholder:"\u041f\u043e\u0438\u0441\u043a \u0441\u0440\u0435\u0434\u0438 \u043a\u043e\u043d\u0442\u0430\u043a\u0442\u043e\u0432",size:"large",value:c})),r.a.createElement(ke,{dialogs:t,me:a,onSelectDialog:i}))};Le.defaultProps={inputValue:"",me:{},dialogs:[]};var Ue=Le,Me=Object(l.b)((function(e){var a=e.user,t=e.dialogs.dialogs,n=e.currentDialog.currentDialog;return{dialogs:t,socket:a.socket,currentDialogId:n,me:a.data}}),G)((function(e){var a=e.me,t=e.dialogs,c=e.socket,i=e.currentDialogId,l=e.updateLastMessage,o=e.updateLastMessageReaded,s=e.setCurrentDialog,u=e.fetchDialogs,d=e.addDialog,m=e.updateUnreadedCount,E=e.setPartnerStatus,g=Object(n.useState)(),f=Object(Z.a)(g,2),_=f[0],p=f[1],h=Object(n.useState)(t),v=Object(Z.a)(h,2),b=v[0],S=v[1],O=Object(n.useRef)(null);Object(n.useEffect)((function(){t.length?S(t):u()}),[t]),Object(n.useEffect)((function(){return c.on("SERVER:DIALOG_CREATED",j),c.on("SERVER:MESSAGES_READED",A),function(){c.removeListener("SERVER:MESSAGE_READED",A),c.removeListener("SERVER:DIALOG_CREATED",j)}}),[a,i]),Object(n.useEffect)((function(){return c.on("USER_CONNECTED",T),c.on("USER_DISCONNECTED",R),c.on("SERVER:MESSAGE_CREATED",D),c.on("MESSAGE_TYPING",y),function(){c.removeListener("USER_CONNECTED",T),c.removeListener("USER_DISCONNECTED",R),c.removeListener("SERVER:MESSAGE_CREATED",D),c.removeListener("MESSAGE_TYPING",y)}}),[a,t,i,b]);var D=function(e){if(N(!1,e.dialog._id),clearTimeout(O.current),i!==e.dialog._id&&a._id!==e.user._id){var n,r=Object(Te.a)(t);try{for(r.s();!(n=r.n()).done;){n.value._id===e.dialog._id&&m(e.dialog._id,e.dialog.unreaded++)}}catch(c){r.e(c)}finally{r.f()}}(a&&e.dialog.author===a._id||e.dialog.partner===a._id)&&l(e.dialog._id,e)},A=function(e){var t=e.dialog_id,n=e.partner_id;a&&n===a._id&&o(t)},j=function(e){a&&a._id===e.partner._id&&d(e)},T=function(e){E(e,!0)},R=function(e){E(e,!1)},N=function(e,a){console.log(b),S(b.map((function(t){return a===t._id&&(t.isTyping=e),t})))},y=function(e){var t=e.user,n=e.dialogId;console.log(b),a&&a._id!==t._id&&(clearTimeout(O.current),N(!0,n),O.current=setTimeout((function(){N(!1,n)}),2e3))};return r.a.createElement(Ue,{me:a,dialogs:b,onSearch:function(e){S(t.filter((function(t){return t[a._id===t.partner._id?"author":"partner"].fullname.toLowerCase().indexOf(e)>=0}))),p(e)},inputValue:_,onSelectDialog:s})})),Pe=function(e){var a=e.modalHandleOk,t=e.showModal,n=e.modalHandleCancel,c=e.modalState,i=e.usersHandleChange,l=e.usersHandleSearch,o=e.usersSearchState,s=e.message,u=e.messageHandleChange,m=e.logout,g=c.visible,f=c.confirmLoading,_=o.value,p=o.fetching,h=o.data.map((function(e){return r.a.createElement(De.a.Option,{key:e._id},e.fullname)}));return r.a.createElement("div",{className:"sidebar"},r.a.createElement("div",{className:"sidebar__header"},r.a.createElement("div",null,r.a.createElement(be.a,{style:{fontSize:"18px"}}),r.a.createElement("span",null,"\u0421\u043f\u0438\u0441\u043e\u043a \u0434\u0438\u0430\u043b\u043e\u0433\u043e\u0432")),r.a.createElement("div",null,r.a.createElement(Ae.a,{title:"\u0421\u043e\u0437\u0434\u0430\u0442\u044c \u0434\u0438\u0430\u043b\u043e\u0433"},r.a.createElement(E.a,{onClick:t,className:"ant-btn--no-border",form:"circle",icon:r.a.createElement(Se.a,{style:{fontSize:"18px"}})})),r.a.createElement(je.a,{title:"\u0421\u043e\u0437\u0434\u0430\u043d\u0438\u0435 \u0434\u0438\u0430\u043b\u043e\u0433\u0430",visible:g,onCancel:n,footer:[r.a.createElement(E.a,{key:"back",onClick:n},"\u041e\u0442\u043c\u0435\u043d\u0430"),r.a.createElement(E.a,{disabled:!_||!s,key:"submit",type:"primary",loading:f,onClick:a},"\u0421\u043e\u0437\u0434\u0430\u0442\u044c")]},r.a.createElement(De.a,{showSearch:!0,value:_,placeholder:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 username \u0438\u043b\u0438 e-mail \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f",style:{width:"100%"},defaultActiveFirstOption:!1,notFoundContent:p?r.a.createElement(_e.a,{size:"small"}):r.a.createElement("span",null,"\u041f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0438 \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d\u044b"),showArrow:!1,filterOption:!1,onSearch:l,onChange:i},h),r.a.createElement("div",{style:{marginTop:"15px"}},r.a.createElement(d.a.TextArea,{value:s,placeholder:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435",autoSize:{minRows:3,maxRows:5},onChange:u}))),r.a.createElement(Ae.a,{title:"\u0412\u044b\u0439\u0442\u0438 \u0438\u0437 \u0430\u043a\u043a\u0430\u0443\u043d\u0442\u0430"},r.a.createElement(E.a,{onClick:m,className:"ant-btn--no-border",form:"circle",icon:r.a.createElement(Oe.a,{style:{fontSize:"18px"}})})))),r.a.createElement("div",{className:"sidebar__dialogs"},r.a.createElement(Me,null)))},Ge=Object(l.b)((function(e){return e}),Object(Y.a)(Object(Y.a)(Object(Y.a)({},G),V),x))(Object(s.g)((function(e){var a=e.createDialog,t=e.clearUserData,c=e.clearCurrentDialog,i=e.clearDialogs,l=e.history,o=Object(n.useState)({data:[],fetching:!1,value:void 0}),s=Object(Z.a)(o,2),u=s[0],d=s[1],m=Object(n.useState)({visible:!1,confirmLoading:!1}),E=Object(Z.a)(m,2),g=E[0],f=E[1],_=Object(n.useState)(""),p=Object(Z.a)(_,2),h=p[0],v=p[1];return r.a.createElement(Pe,{showModal:function(){f(Object(Y.a)(Object(Y.a)({},g),{},{visible:!0}))},modalHandleCancel:function(){f(Object(Y.a)(Object(Y.a)({},g),{},{visible:!1}))},modalHandleOk:function(){u.value&&(f(Object(Y.a)(Object(Y.a)({},g),{},{confirmLoading:!0})),a(u.value,h).then((function(){f({visible:!1,confirmLoading:!1}),d({data:[],fetching:!1,value:void 0}),v("")})))},modalState:g,usersHandleSearch:function(e){e?(d(Object(Y.a)(Object(Y.a)({},u),{},{fetching:!0})),I(e).then((function(e){200===e.status&&d(Object(Y.a)(Object(Y.a)({},u),{},{fetching:!1,data:e.data}))})).catch((function(e){d(Object(Y.a)(Object(Y.a)({},u),{},{fetching:!1}))}))):d(Object(Y.a)(Object(Y.a)({},u),{},{data:[]}))},usersHandleChange:function(e){d(Object(Y.a)(Object(Y.a)({},u),{},{value:e}))},usersSearchState:u,messageHandleChange:function(e){var a=e.target.value;v(a)},message:h,logout:function(){t(),c(),i(),l.push("/login")}})}))),xe=function(){return r.a.createElement("section",{className:"home"},r.a.createElement("div",{className:"chat"},r.a.createElement("div",{className:"chat__sidebar"},r.a.createElement(Ge,null)),r.a.createElement("div",{className:"chat__dialog"},r.a.createElement("div",{className:"chat__dialog-messages"},r.a.createElement(ve,null)))))};var Ve=Object(l.b)((function(e){var a=e.user;return{isAuth:a.isAuth,token:a.token,me:a.data}}),V)((function(e){var a=e.me,t=e.isAuth,c=e.token,i=e.fetchUserData;return Object(n.useEffect)((function(){c&&!a&&i(c)}),[a]),r.a.createElement("div",{className:"wrapper"},r.a.createElement(o.a,null,r.a.createElement(s.d,null,r.a.createElement(s.b,{exact:!0,path:"/",render:function(){return t?r.a.createElement(s.a,{to:"/im"}):r.a.createElement(s.a,{to:"/login"})}}),r.a.createElement(s.b,{exact:!0,path:["/login","/register"],render:function(){return t?r.a.createElement(s.a,{to:"/im"}):r.a.createElement(K,null)}}),r.a.createElement(s.b,{exact:!0,path:"/im",render:function(){return t?r.a.createElement(xe,null):r.a.createElement(s.a,{to:"/login"})}}))))}));Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var ze=t(64),He=t(142),Fe={dialogs:[]},Be={DIALOGS_SET_ITEMS:function(e,a){return Object(Y.a)(Object(Y.a)({},e),{},{dialogs:a})},CLEAR_DIALOGS:function(){return Fe},ADD_DIALOG:function(e,a){return Object(Y.a)(Object(Y.a)({},e),{},{dialogs:[].concat(Object(He.a)(e.dialogs),[a])})},UPDATE_LAST_MESSAGE:function(e,a){var t=a.dialogId,n=a.message;return Object(Y.a)(Object(Y.a)({},e),{},{dialogs:e.dialogs.map((function(e){return t===e._id&&(e.lastMessage=n),e}))})},UPDATE_LAST_MESSAGE_READED:function(e,a){return Object(Y.a)(Object(Y.a)({},e),{},{dialogs:e.dialogs.map((function(e){return a===e._id&&(e.lastMessage.isReaded=!0),e}))})},UPDATE_UNREADED_COUNT:function(e,a){var t=a.dialogId,n=a.unreadedCount;return Object(Y.a)(Object(Y.a)({},e),{},{dialogs:e.dialogs.map((function(e){return t===e._id&&(e.unreaded=n),e}))})},SET_PARTNER_STATUS:function(e,a){var t=a.partnerId,n=a.isOnline;return Object(Y.a)(Object(Y.a)({},e),{},{dialogs:e.dialogs.map((function(e){return t===e.author._id&&(e.author.isOnline=n,e.author.last_seen=(new Date).toISOString()),t===e.partner._id&&(e.partner.isOnline=n,e.partner.last_seen=(new Date).toISOString()),e}))})},DEFAULT:function(e){return e}},qe={items:null,loading:!1,currentDialog:null},Ke={SET_LOADING:function(e,a){return Object(Y.a)(Object(Y.a)({},e),{},{loading:a})},SET_CURRENT_DIALOG:function(e,a){return Object(Y.a)(Object(Y.a)({},e),{},{loading:!1,items:a})},CLEAR_CURRENT_DIALOG:function(){return qe},ADD_MESSAGE:function(e,a){return Object(Y.a)(Object(Y.a)({},e),{},{items:[].concat(Object(He.a)(e.items),[a])})},SET_CURRENT_DIALOG_ID:function(e,a){return Object(Y.a)(Object(Y.a)({},e),{},{currentDialog:a})},UPDATE_IS_READED:function(e,a){var t=a.dialogId,n=a.myId;return Object(Y.a)(Object(Y.a)({},e),{},{items:e.items.map((function(e){return e.dialog._id===t&&e.user._id===n&&(e.isReaded=!0),e}))})},DEFAULT:function(e){return e}},Ye={data:null,token:window.localStorage.token||"",socket:P.a.connect("".concat(A.API_URL,":").concat(A.API_PORT),{query:{token:window.localStorage.token||""}}),isAuth:!!window.localStorage.token},Ze={USER_SET_DATA:function(e,a){return Object(Y.a)(Object(Y.a)({},e),{},{data:a})},CLEAR_USER_DATA:function(){return{data:null,token:"",socket:null,isAuth:!1}},SOCKET_CREATE_CONNECTION:function(e,a){return Object(Y.a)(Object(Y.a)({},e),{},{socket:a})},SET_TOKEN:function(e,a){return Object(Y.a)(Object(Y.a)({},e),{},{token:a})},SET_IS_AUTH:function(e,a){return Object(Y.a)(Object(Y.a)({},e),{},{isAuth:a})},DEFAULT:function(e){return e}},$e=Object(ze.c)({dialogs:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Fe,a=arguments.length>1?arguments[1]:void 0,t=a.type,n=a.payload,r=Be[t]||Be.DEFAULT;return r(e,n)},currentDialog:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:qe,a=arguments.length>1?arguments[1]:void 0,t=a.type,n=a.payload,r=Ke[t]||Ke.DEFAULT;return r(e,n)},user:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Ye,a=arguments.length>1?arguments[1]:void 0,t=a.type,n=a.payload,r=Ze[t]||Ze.DEFAULT;return r(e,n)}}),Je=t(260),We=window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__||ze.d,Xe=[Je.a],Qe=Object(ze.e)($e,We(ze.a.apply(void 0,Xe)));i.a.render(r.a.createElement(l.a,{store:Qe},r.a.createElement(Ve,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[269,1,2]]]);
//# sourceMappingURL=main.af53831a.chunk.js.map